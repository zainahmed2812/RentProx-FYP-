<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Admins</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/shared.css">

  <style>
/* Page Structure */
.content-wrapper {
  display: flex;
  flex-direction: column;
  gap: 25px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.page-header h2 {
  font-size: 22px;
  font-weight: 600;
}

/* Buttons */
.primary-btn {
  padding: 10px 18px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(90deg, #6C63FF, #8E7CFF);
  color: white;
  cursor: pointer;
  font-weight: 500;
  transition: 0.3s;
}

.primary-btn:hover {
  opacity: 0.9;
}

.secondary-btn {
  padding: 10px 18px;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: white;
  cursor: pointer;
}

/* Form Card */
.form-card {
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.06);
}

.form-card h3 {
  margin-bottom: 20px;
  font-weight: 600;
}

/* Grid Layout */
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}

/* Form Elements */
.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  margin-bottom: 6px;
  font-size: 13px;
  color: #555;
}

.form-group input,
.form-group select {
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #ddd;
  outline: none;
  transition: 0.3s;
}

.form-group input:focus,
.form-group select:focus {
  border-color: #6C63FF;
  box-shadow: 0 0 0 2px rgba(108,99,255,0.15);
}

/* Actions */
.form-actions {
  margin-top: 25px;
  display: flex;
  gap: 15px;
}
  </style>
</head>
<body>
    <div class="content-wrapper">

  <!-- Page Title -->
  <div class="page-header">
    <h2>Manage Admins</h2>
    <button class="primary-btn" id="addAdminBtn">+ Add New Admin</button>
  </div>

  <!-- Add Admin Form Card -->
  <div class="form-card">

    <h3>Create New Admin</h3>

    <div class="form-grid">

      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="adminName" placeholder="Enter admin name">
      </div>

      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="adminEmail" placeholder="Enter email">
      </div>

      <div class="form-group">
        <label>Password</label>
        <input type="password" id="adminPassword" placeholder="Enter password">
      </div>

      <div class="form-group">
        <label>Status</label>
        <select id="adminStatus">
          <option value="1">Active</option>
          <option value="0">Inactive</option>
        </select>
      </div>

    </div>

    <div class="form-actions">
      <button class="primary-btn" id="createAdminBtn">Create Admin</button>
      <button class="secondary-btn" id="cancelBtn">Cancel</button>
    </div>

  </div>

  <!-- Admins List -->
  <div class="content-box" id="adminsList">
    Loading admins...
  </div>

</div>

<script>
(async function(){
  try {
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = 'admin_login.html';
      return;
    }

    const res = await fetch('/api/admins', {
      headers: { 'Authorization': 'Bearer ' + token }
    });

    if (res.status === 401) {
      // token invalid or expired
      localStorage.removeItem('token');
      window.location.href = 'admin_login.html';
      return;
    }

    if (!res.ok) {
      document.getElementById('adminsList').innerText = 'Failed to load admins';
      return;
    }

    const data = await res.json();
    if (!data.success) {
      document.getElementById('adminsList').innerText = data.message || 'No admins';
      return;
    }

    const list = data.admins;
    if (!list || list.length === 0) {
      document.getElementById('adminsList').innerText = 'No admins found.';
      return;
    }

    const container = document.getElementById('adminsList');
    container.innerHTML = '';
    const table = document.createElement('table');
    table.style.width = '100%';
    table.style.borderCollapse = 'collapse';
    const thead = document.createElement('thead');
    thead.innerHTML = '<tr><th style="text-align:left; padding:8px;">ID</th><th style="text-align:left; padding:8px;">Name</th><th style="text-align:left; padding:8px;">Email</th><th style="text-align:left; padding:8px;">Active</th></tr>';
    table.appendChild(thead);
    const tbody = document.createElement('tbody');
    list.forEach(a => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td style="padding:8px; border-top:1px solid #eee">${a.id}</td><td style="padding:8px; border-top:1px solid #eee">${a.name || ''}</td><td style="padding:8px; border-top:1px solid #eee">${a.email}</td><td style="padding:8px; border-top:1px solid #eee">${a.is_active ? 'Yes' : 'No'}</td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    container.appendChild(table);

    // Wire Create Admin button (simple POST)
    document.getElementById('createAdminBtn').addEventListener('click', async function(){
      const name = document.getElementById('adminName').value.trim();
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPassword').value;
      const is_active = document.getElementById('adminStatus').value;
      if (!name || !email || !password) return alert('Fill all fields');

      const resp = await fetch('/api/admins', {
        method: 'POST',
        headers: { 'Content-Type':'application/json', 'Authorization': 'Bearer ' + token },
        body: JSON.stringify({ name, email, password, is_active })
      });

      if (resp.status === 401) { localStorage.removeItem('token'); window.location.href='admin_login.html'; return; }
      const jr = await resp.json();
      if (!jr.success) return alert(jr.message || 'Create failed');
      alert('Admin created');
      window.location.reload();
    });

    document.getElementById('cancelBtn').addEventListener('click', function(){
      window.location.href = 'admin_dashboard.html';
    });

  } catch (err) {
    console.error(err);
    document.getElementById('adminsList').innerText = 'Error loading admins';
  }
})();
</script>

</body>
</html>