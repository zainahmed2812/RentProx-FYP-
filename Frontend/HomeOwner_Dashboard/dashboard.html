<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard ‚Äî RentProx</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-body: #f4f7fa;
      --sidebar-bg: #ffffff;
      --card-bg: #ffffff;
      --primary: #00a3ff;
      --primary-glow: rgba(0, 163, 255, 0.3);
      --text-main: #1a1d23;
      --text-muted: #788293;
      --success: #00d084;
      --danger: #ff4d4d;
      --radius-lg: 20px;
      --radius-md: 12px;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
    }

    * { box-sizing: border-box; transition: all 0.2s ease; }
    body {
      margin: 0; font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: var(--bg-body); color: var(--text-main);
      display: flex; height: 100vh; overflow: hidden;
    }

    /* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
    .sidebar {
      width: 260px; background: var(--sidebar-bg); padding: 30px 20px;
      display: flex; flex-direction: column; border-right: 1px solid rgba(0,0,0,0.05);
    }
    .brand { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 40px; padding-left: 10px; }
    .nav-link {
      display: flex; align-items: center; gap: 12px; padding: 14px 18px;
      text-decoration: none; color: var(--text-muted); font-weight: 600;
      border-radius: var(--radius-md); margin-bottom: 8px;
    }
    .nav-link:hover { background: rgba(0, 163, 255, 0.05); color: var(--primary); }
    .nav-link.active { background: var(--primary); color: #fff; box-shadow: 0 8px 20px var(--primary-glow); }
    .btn-logout { margin-top: auto; background: #fdf2f2; color: var(--danger); text-align: center; padding: 12px; border-radius: var(--radius-md); text-decoration: none; font-weight: 700; }

    /* ‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê */
    .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow-y: auto; padding: 40px; }
    .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .welcome-text h1 { margin: 0; font-size: 1.8rem; }
    .welcome-text p { margin: 5px 0 0; color: var(--text-muted); }

    /* STATS */
    .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-bottom: 30px; }
    .stat-card { background: var(--card-bg); padding: 25px; border-radius: var(--radius-lg); box-shadow: var(--shadow); display: flex; align-items: center; gap: 20px; }
    .stat-icon { width: 50px; height: 50px; background: rgba(0, 163, 255, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: var(--primary); }
    .stat-info .value { font-size: 1.5rem; font-weight: 800; display: block; }
    .stat-info .label { color: var(--text-muted); font-size: 0.9rem; font-weight: 600; }

    /* GRID PANELS */
    .dashboard-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px; }
    .panel { background: var(--card-bg); border-radius: var(--radius-lg); padding: 25px; box-shadow: var(--shadow); }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .panel-title { font-weight: 700; font-size: 1.1rem; }

    .search-box { background: #f8fafc; border: 1px solid #edf2f7; border-radius: 12px; padding: 10px 15px; display: flex; align-items: center; margin-bottom: 15px; }
    .search-box input { border: none; background: transparent; outline: none; width: 100%; margin-left: 10px; }

    .item-row { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #f1f4f8; }
    .btn-action { background: var(--primary); color: #fff; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .btn-add { width: 100%; background: #f0f7ff; color: var(--primary); border: 2px dashed var(--primary); padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; margin-bottom: 20px; }

    /* ‚ïê‚ïê MODALS ‚ïê‚ïê */
    .modal-overlay { 
      position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); 
      display: none; align-items: center; justify-content: center; z-index: 1000; 
    }
    .modal-overlay.active { display: flex; }
    .modal { background: #fff; padding: 30px; border-radius: var(--radius-lg); width: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
    .modal-title { font-size: 1.3rem; font-weight: 800; margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    .form-label { display: block; font-size: 0.85rem; font-weight: 700; margin-bottom: 6px; }
    .form-input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #edf2f7; background: #f8fafc; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; }
    .btn-save { background: var(--primary); color: #fff; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    .btn-cancel { background: #f1f4f8; color: var(--text-muted); border: none; padding: 10px 20px; border-radius: 10px; font-weight: 700; cursor: pointer; }

    .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;}
    .badge-paid { background: #e6fffa; color: var(--success); }
    .badge-pending { background: #fff5f5; color: var(--danger); }
  </style>
</head>
<body>

  <nav class="sidebar">
    <div class="brand">RentProx</div>
    <div class="nav-group">
      <a href="dashboard.html" class="nav-link active">Dashboard</a>
      <a href="properties.html" class="nav-link">Properties</a>
      <a href="ledger.html" class="nav-link">Rent Ledger</a>
    </div>
    <a href="../login_plm.html" class="btn-logout">Log Out</a>
  </nav>

  <main class="main-wrapper">
    <header class="header-area">
      <div class="welcome-text">
        <h1>Overview</h1>
        <p>Welcome back ‚Äî here's your portfolio at a glance.</p>
      </div>
    </header>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon">üè¢</div>
        <div class="stat-info">
          <span class="value" id="stat-props">‚Äî</span>
          <span class="label">Total Properties</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <span class="value" id="stat-tenants">‚Äî</span>
          <span class="label">Active Tenants</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üí≥</div>
        <div class="stat-info">
          <span class="value" id="stat-pending">‚Äî</span>
          <span class="label">Pending Payments</span>
        </div>
      </div>
    </div>

    <div class="dashboard-grid">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Tenant Management</span>
          <a href="ledger.html" style="color:var(--primary); font-size: 0.9rem; font-weight:700; text-decoration:none;">View All ‚Üí</a>
        </div>
        <div class="search-box">
          üîç <input type="text" id="tenant-search" placeholder="Search tenants..." oninput="filterTenants(this.value)">
        </div>
        <div id="tenant-list"></div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Manage Properties</span>
          <a href="properties.html" style="color:var(--primary); font-size: 0.9rem; font-weight:700; text-decoration:none;">View All ‚Üí</a>
        </div>
        <button class="btn-add" onclick="openPropertyModal()">+ Add Property</button>
        <div id="property-list"></div>
      </div>
    </div>
  </main>

  <div class="modal-overlay" id="tenant-modal" onclick="if(event.target===this)closeModal('tenant-modal')">
    <div class="modal">
      <div class="modal-title">Tenant Details</div>
      <div id="tenant-details-content">
          <p><strong>Name:</strong> <span id="td-name"></span></p>
          <p><strong>Unit:</strong> <span id="td-unit"></span></p>
          <p><strong>Monthly Rent:</strong> <span id="td-rent"></span></p>
          <p><strong>Status:</strong> <span id="td-status"></span></p>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeModal('tenant-modal')">Close</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="property-modal" onclick="if(event.target===this)closeModal('property-modal')">
    <div class="modal">
      <div class="modal-title" id="pm-title">Add Property</div>
      <input type="hidden" id="pm-id" />
      <div class="form-group">
        <label class="form-label">Property Name</label>
        <input class="form-input" id="pm-name" placeholder="e.g. DHA Block C" />
      </div>
      <div class="form-group">
        <label class="form-label">Address</label>
        <input class="form-input" id="pm-address" placeholder="e.g. Phase 5, Lahore" />
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeModal('property-modal')">Cancel</button>
        <button class="btn-save" onclick="saveProperty()">Save Property</button>
      </div>
    </div>
  </div>

  <script src="js/store.js"></script>
  <script>
    // Stats Initialization
    function updateStats() {
        document.getElementById('stat-props').textContent = Store.stats.totalProperties;
        document.getElementById('stat-tenants').textContent = Store.stats.activeTenants;
        document.getElementById('stat-pending').textContent = Store.stats.pendingPayments;
    }

    // Render Tenants
    function renderTenants(list) {
      const el = document.getElementById('tenant-list');
      if (!list.length) {
        el.innerHTML = '<div style="text-align:center; color:var(--text-muted); padding:20px;">No tenants found.</div>';
        return;
      }
      el.innerHTML = list.map(t => `
        <div class="item-row">
          <div>
            <strong>${t.name}</strong><br>
            <small style="color:var(--text-muted)">Unit ${t.unit}</small>
          </div>
          <button class="btn-action" onclick="openTenantModal(${t.id})">View</button>
        </div>`).join('');
    }

    function filterTenants(q) { renderTenants(Store.getTenants(q)); }

    // Render Properties
    function renderProperties() {
      const el = document.getElementById('property-list');
      const props = Store.properties.slice(0, 4);
      el.innerHTML = props.map(p => `
        <div class="item-row">
          <div>
            <strong>${p.name}</strong><br>
            <small style="color:var(--text-muted)">${p.address}</small>
          </div>
          <span style="color:var(--primary); font-weight:bold; cursor:pointer" onclick="openPropertyModal(${p.id})">Edit</span>
        </div>`).join('');
    }

    // Modal Logic
    function openTenantModal(id) {
      const t = Store.getTenant(id);
      document.getElementById('td-name').textContent = t.name;
      document.getElementById('td-unit').textContent = t.unit;
      document.getElementById('td-rent').textContent = 'PKR ' + t.rent.toLocaleString();
      document.getElementById('td-status').innerHTML = `<span class="badge badge-${t.status}">${t.status}</span>`;
      openModal('tenant-modal');
    }

    function openPropertyModal(id) {
      const prop = id ? Store.properties.find(p => p.id == id) : null;
      document.getElementById('pm-title').textContent = prop ? 'Edit Property' : 'Add Property';
      document.getElementById('pm-id').value = prop ? prop.id : '';
      document.getElementById('pm-name').value = prop ? prop.name : '';
      document.getElementById('pm-address').value = prop ? prop.address : '';
      openModal('property-modal');
    }

    function saveProperty() {
      const id = document.getElementById('pm-id').value;
      const name = document.getElementById('pm-name').value.trim();
      const address = document.getElementById('pm-address').value.trim();
      if (!name) return alert('Enter a name');
      
      if (id) Store.updateProperty(id, { name, address });
      else Store.addProperty({ name, address, units: 0, occupied: 0 });
      
      closeModal('property-modal');
      renderProperties();
      updateStats();
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // Initial Load
    window.onload = () => {
        updateStats();
        renderTenants(Store.getTenants());
        renderProperties();
    };
  </script>
</body>
</html>