<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Properties ‚Äî RentProx</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-body: #f4f7fa;
      --sidebar-bg: #ffffff;
      --card-bg: #ffffff;
      --primary: #00a3ff;
      --primary-glow: rgba(0, 163, 255, 0.3);
      --text-main: #1a1d23;
      --text-muted: #788293;
      --radius-lg: 20px;
      --radius-md: 12px;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
    }

    * { box-sizing: border-box; transition: all 0.2s ease; }
    body {
      margin: 0; font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: var(--bg-body); color: var(--text-main);
      display: flex; height: 100vh; overflow: hidden;
    }

    /* ‚ïê‚ïê SIDEBAR (Identical to Dashboard) ‚ïê‚ïê */
    .sidebar {
      width: 260px; background: var(--sidebar-bg); padding: 30px 20px;
      display: flex; flex-direction: column; border-right: 1px solid rgba(0,0,0,0.05);
    }
    .brand { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin-bottom: 40px; padding-left: 10px; }
    .nav-link {
      display: flex; align-items: center; gap: 12px; padding: 14px 18px;
      text-decoration: none; color: var(--text-muted); font-weight: 600;
      border-radius: var(--radius-md); margin-bottom: 8px;
    }
    .nav-link:hover { background: rgba(0, 163, 255, 0.05); color: var(--primary); }
    .nav-link.active { background: var(--primary); color: #fff; box-shadow: 0 8px 20px var(--primary-glow); }
    .btn-logout { margin-top: auto; background: #fdf2f2; color: #ff4d4d; text-align: center; padding: 12px; border-radius: var(--radius-md); text-decoration: none; font-weight: 700; }

    /* ‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê */
    .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow-y: auto; padding: 40px; }
    .header-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .welcome-text h1 { margin: 0; font-size: 1.8rem; }
    
    .btn-primary-add {
      background: var(--primary); color: #fff; border: none; padding: 12px 24px;
      border-radius: var(--radius-md); font-weight: 700; cursor: pointer;
      box-shadow: 0 4px 15px var(--primary-glow);
    }

    /* ‚ïê‚ïê PROPERTIES GRID ‚ïê‚ïê */
    .properties-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px;
    }

    .property-card {
      background: var(--card-bg); border-radius: var(--radius-lg); padding: 25px;
      box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.02);
      display: flex; flex-direction: column; gap: 15px;
    }

    .card-head { display: flex; align-items: flex-start; justify-content: space-between; }
    .property-icon { 
      width: 45px; height: 45px; background: #f0f7ff; border-radius: 12px;
      display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
    }

    .property-name { font-weight: 800; font-size: 1.15rem; color: var(--text-main); margin-bottom: 4px; }
    .property-addr { color: var(--text-muted); font-size: 0.85rem; display: block; }

    /* Occupancy Bar */
    .occ-container { margin: 10px 0; }
    .occ-text { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 700; margin-bottom: 8px; }
    .occ-bar-bg { height: 8px; background: #f1f4f8; border-radius: 10px; overflow: hidden; }
    .occ-bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #61a8ff); border-radius: 10px; }

    .btn-edit-card {
      background: #f8fafc; color: var(--primary); border: 1px solid #edf2f7;
      padding: 10px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%;
      margin-top: 5px;
    }
    .btn-edit-card:hover { background: var(--primary); color: #fff; }

    /* ‚ïê‚ïê MODALS ‚ïê‚ïê */
    .modal-overlay { 
      position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); 
      display: none; align-items: center; justify-content: center; z-index: 1000; 
    }
    .modal-overlay.active { display: flex; }
    .modal { background: #fff; padding: 30px; border-radius: var(--radius-lg); width: 480px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
    .modal-title { font-size: 1.3rem; font-weight: 800; margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    .form-label { display: block; font-size: 0.85rem; font-weight: 700; margin-bottom: 6px; }
    .form-input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #edf2f7; background: #f8fafc; font-family: inherit; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; }
    .btn-save { background: var(--primary); color: #fff; border: none; padding: 12px 24px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    .btn-cancel { background: #f1f4f8; color: var(--text-muted); border: none; padding: 12px 24px; border-radius: 10px; font-weight: 700; cursor: pointer; }

    .empty-state { grid-column: 1/-1; text-align: center; padding: 60px; color: var(--text-muted); }
  </style>
</head>
<body>

  <nav class="sidebar">
    <div class="brand">RentProx</div>
    <div class="nav-group">
      <a href="dashboard.html" class="nav-link">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
        Dashboard
      </a>
      <a href="properties.html" class="nav-link active">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        Properties
      </a>
      <a href="ledger.html" class="nav-link">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
        Rent Ledger
      </a>
    </div>
    <a href="../login_plm.html" class="btn-logout">Log Out</a>
  </nav>

  <main class="main-wrapper">
    <header class="header-area">
      <div class="welcome-text">
        <h1>Properties</h1>
        <p style="color: var(--text-muted); margin-top: 5px;">Manage and monitor your real estate portfolio.</p>
      </div>
      <button class="btn-primary-add" onclick="openPropertyModal()">+ Add New Property</button>
    </header>

    <div class="properties-grid" id="properties-grid">
      </div>
  </main>

  <div class="modal-overlay" id="property-modal" onclick="if(event.target===this)closeModal('property-modal')">
    <div class="modal">
      <div class="modal-title" id="pm-title">Add Property</div>
      <input type="hidden" id="pm-id" />
      
      <div class="form-group">
        <label class="form-label">Property Name</label>
        <input class="form-input" id="pm-name" placeholder="e.g. DHA Block C" />
      </div>
      
      <div class="form-group">
        <label class="form-label">Address</label>
        <input class="form-input" id="pm-address" placeholder="e.g. Phase 5, Lahore" />
      </div>
      
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="form-group">
          <label class="form-label">Total Units</label>
          <input class="form-input" id="pm-units" type="number" min="0" placeholder="0" />
        </div>
        <div class="form-group">
          <label class="form-label">Occupied Units</label>
          <input class="form-input" id="pm-occupied" type="number" min="0" placeholder="0" />
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeModal('property-modal')">Cancel</button>
        <button class="btn-save" onclick="saveProperty()">Save Property</button>
      </div>
    </div>
  </div>

  <script src="js/store.js"></script>
  <script>
    function renderProperties() {
      const el = document.getElementById('properties-grid');
      if (!Store.properties || Store.properties.length === 0) {
        el.innerHTML = `
          <div class="empty-state">
            <div style="font-size: 3rem; margin-bottom: 10px;">üèòÔ∏è</div>
            <h3>No properties found</h3>
            <p>Start by adding your first property to the portfolio.</p>
          </div>`;
        return;
      }

      el.innerHTML = Store.properties.map(p => {
        const pct = p.units > 0 ? Math.round((p.occupied / p.units) * 100) : 0;
        return `
        <div class="property-card">
          <div class="card-head">
            <div class="property-icon">üè¢</div>
            <div style="flex: 1; margin-left: 15px;">
              <div class="property-name">${p.name}</div>
              <span class="property-addr">${p.address}</span>
            </div>
          </div>

          <div class="occ-container">
            <div class="occ-text">
              <span>Occupancy</span>
              <span>${pct}%</span>
            </div>
            <div class="occ-bar-bg">
              <div class="occ-bar-fill" style="width: ${pct}%"></div>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px; font-weight: 600;">
              ${p.occupied} of ${p.units} units are currently occupied
            </div>
          </div>

          <button class="btn-edit-card" onclick="openPropertyModal(${p.id})">Edit Details</button>
        </div>`;
      }).join('');
    }

    // Modal Logic
    function openPropertyModal(id) {
      const prop = id ? Store.properties.find(p => p.id == id) : null;
      document.getElementById('pm-title').textContent = prop ? 'Edit Property' : 'Add Property';
      document.getElementById('pm-id').value = prop ? prop.id : '';
      document.getElementById('pm-name').value = prop ? prop.name : '';
      document.getElementById('pm-address').value = prop ? prop.address : '';
      document.getElementById('pm-units').value = prop ? prop.units : '';
      document.getElementById('pm-occupied').value = prop ? prop.occupied : '';
      openModal('property-modal');
    }

    function saveProperty() {
      const id = document.getElementById('pm-id').value;
      const name = document.getElementById('pm-name').value.trim();
      const address = document.getElementById('pm-address').value.trim();
      const units = parseInt(document.getElementById('pm-units').value) || 0;
      const occupied = parseInt(document.getElementById('pm-occupied').value) || 0;

      if (!name) return alert('Please enter a property name.');
      if (occupied > units) return alert('Occupied units cannot exceed total units.');

      if (id) {
        Store.updateProperty(id, { name, address, units, occupied });
      } else {
        Store.addProperty({ name, address, units, occupied });
      }

      closeModal('property-modal');
      renderProperties();
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // Initialize
    document.addEventListener('DOMContentLoaded', renderProperties);
  </script>
</body>
</html>