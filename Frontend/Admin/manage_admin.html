<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Admins — RentProx</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing:border-box; font-family:'Poppins',sans-serif; margin:0; padding:0; }
    body { background:#F5F7FB; color:#222; }
    .layout { display:flex; min-height:100vh; }
    .sidebar { width:240px; background:#1F1F2E; color:#fff; padding:20px; }
    .sidebar h2 { margin-bottom:30px; font-weight:600; }
    .sidebar ul { list-style:none; }
    .sidebar ul li { margin-bottom:15px; }
    .sidebar ul li a { text-decoration:none; color:#CFCFE8; display:block; padding:10px 12px; border-radius:8px; transition:0.3s; }
    .sidebar ul li a:hover, .sidebar ul li a.active { background:linear-gradient(90deg,#6C63FF,#8E7CFF); color:#fff; }
    .main { flex:1; padding:30px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; }
    .topbar h1 { font-size:22px; font-weight:600; }
    .profile { background:#fff; padding:8px 15px; border-radius:30px; box-shadow:0 4px 12px rgba(0,0,0,0.05); font-weight:600; }

    .form-card { background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.06); margin-bottom:24px; }
    .form-card h3 { margin-bottom:20px; font-weight:600; }
    .form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:18px; }
    .form-group { display:flex; flex-direction:column; }
    .form-group label { margin-bottom:6px; font-size:12px; color:#555; font-weight:600; }
    .form-group input { padding:10px 12px; border-radius:8px; border:1px solid #ddd; outline:none; transition:0.3s; }
    .form-group input:focus { border-color:#6C63FF; }
    .form-actions { margin-top:20px; }
    .primary-btn { padding:10px 20px; border:none; border-radius:8px; background:linear-gradient(90deg,#6C63FF,#8E7CFF); color:#fff; cursor:pointer; font-weight:600; transition:0.3s; }
    .primary-btn:hover { opacity:0.9; }
    .primary-btn:disabled { opacity:0.6; cursor:not-allowed; }

    .content-box { background:#fff; padding:25px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
    .content-box h3 { font-size:1rem; font-weight:600; margin-bottom:18px; }

    table { width:100%; border-collapse:collapse; }
    th { text-align:left; padding:12px 10px; font-size:12px; color:#888; font-weight:700; border-bottom:2px solid #f0f0f0; text-transform:uppercase; }
    td { padding:14px 10px; border-bottom:1px solid #f9f9f9; font-size:0.88rem; }
    tr:hover td { background:#fafafa; }

    .delete-btn { padding:6px 12px; border-radius:6px; border:1px solid #ef4444; color:#ef4444; background:#fff; cursor:pointer; font-size:0.8rem; font-weight:600; transition:0.2s; }
    .delete-btn:hover { background:#ef4444; color:#fff; }
    .delete-btn:disabled { opacity:0.5; cursor:not-allowed; }

    .skeleton { background:linear-gradient(90deg,#f0f0f0 25%,#e8e8e8 50%,#f0f0f0 75%); background-size:200% 100%; animation:shimmer 1.4s infinite; border-radius:6px; height:44px; margin-bottom:8px; }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .empty-state { text-align:center; padding:40px; color:#999; font-size:0.9rem; }
  </style>
</head>
<body>
<div class="layout">
  <aside class="sidebar">
    <h2>RentProx</h2>
    <ul>
      <li><a href="admin_dashboard.html">Dashboard</a></li>
      <li><a href="manage_admins.html" class="active">Manage Admins</a></li>
      <li><a href="#" id="logout-link">Logout</a></li>
    </ul>
  </aside>

  <div class="main">
    <div class="topbar">
      <h1>Manage Admins</h1>
      <div class="profile" id="profile-name">Admin</div>
    </div>

    <!-- Create Admin Form -->
    <div class="form-card">
      <h3>Create New Admin</h3>
      <div class="form-grid">
        <div class="form-group"><label>Full Name *</label><input type="text" id="inp-name" placeholder="Admin ka naam"></div>
        <div class="form-group"><label>Email Address *</label><input type="email" id="inp-email" placeholder="admin@example.com"></div>
        <div class="form-group"><label>Phone *</label><input type="text" id="inp-phone" placeholder="03001234567"></div>
        <div class="form-group"><label>CNIC *</label><input type="text" id="inp-cnic" placeholder="13 digits"></div>
        <div class="form-group"><label>Address *</label><input type="text" id="inp-address" placeholder="City, Area"></div>
        <div class="form-group"><label>Password *</label><input type="password" id="inp-password" placeholder="Min 6 characters"></div>
      </div>
      <div class="form-actions">
        <button class="primary-btn" id="create-btn">Create Admin</button>
      </div>
    </div>

    <!-- Admins List -->
    <div class="content-box">
      <h3>All Admins</h3>
      <div id="admins-wrap"><div class="skeleton"></div><div class="skeleton"></div></div>
    </div>
  </div>
</div>

<script src="../api.js"></script>
<script>
let adminsCache = [];

(async function init() {
  const user = await Auth.adminGuard('admin_login.html');
  if (!user) return;

  document.getElementById('profile-name').textContent = user.name;
  document.getElementById('logout-link').addEventListener('click', e => {
    e.preventDefault();
    Auth.logout('admin_login.html');
  });

  document.getElementById('create-btn').addEventListener('click', createAdmin);
  await loadAdmins();
})();

async function loadAdmins() {
  try {
    // Fetch all users — filter admins client-side
    // (If you add /api/admin/users endpoint later, use that instead)
    const data = await apiFetch('/admin/dashboard');
    if (!data.success) {
      document.getElementById('admins-wrap').innerHTML = '<div class="empty-state">Data load nahi hua.</div>';
      return;
    }
    // Show recent users as a placeholder — replace with proper admin list API if added
    renderAdminsTable(data.data.recentUsers || []);
  } catch {
    document.getElementById('admins-wrap').innerHTML = '<div class="empty-state">Network error.</div>';
  }
}

function renderAdminsTable(list) {
  const wrap = document.getElementById('admins-wrap');
  if (!list.length) {
    wrap.innerHTML = '<div class="empty-state">Abhi koi admin nahi. Upar form se create karein.</div>';
    return;
  }
  wrap.innerHTML = `
    <table>
      <thead><tr><th>Name</th><th>Email</th><th>Joined</th><th>Status</th></tr></thead>
      <tbody>
        ${list.map(u => `
          <tr>
            <td><strong>${u.name}</strong></td>
            <td>${u.email}</td>
            <td>${new Date(u.createdAt).toLocaleDateString('en-PK')}</td>
            <td><span style="color:${u.active ? '#28b446' : '#ef4444'};font-weight:600;">${u.active ? 'Active' : 'Inactive'}</span></td>
          </tr>`).join('')}
      </tbody>
    </table>`;
}

async function createAdmin() {
  const name     = document.getElementById('inp-name').value.trim();
  const email    = document.getElementById('inp-email').value.trim();
  const phone    = document.getElementById('inp-phone').value.trim();
  const cnic     = document.getElementById('inp-cnic').value.trim();
  const address  = document.getElementById('inp-address').value.trim();
  const password = document.getElementById('inp-password').value;

  if (!name || !email || !phone || !cnic || !address || !password) {
    showToast('Tamam fields zaruri hain.', 'error');
    return;
  }

  const btn = document.getElementById('create-btn');
  btn.disabled = true;
  btn.textContent = 'Creating...';

  try {
    // Create user via signup, then note: to make them admin,
    // you need to add /api/admin/create-admin endpoint in backend
    // OR manually set isAdmin=true in database
    const data = await apiFetch('/auth/signup', {
      method: 'POST',
      body: JSON.stringify({ name, email, phone, cnic, address, password })
    });

    if (data.success) {
      showToast('User create ho gaya! DB mein isAdmin=true set karein admin banane ke liye.', 'warn');
      // Clear form
      ['inp-name','inp-email','inp-phone','inp-cnic','inp-address','inp-password']
        .forEach(id => document.getElementById(id).value = '');
      await loadAdmins();
    } else {
      showToast(data.message || 'Create fail hua.', 'error');
    }
  } catch {
    showToast('Network error.', 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'Create Admin';
  }
}
</script>
</body>
</html>