<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RentProx - Login</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*{ margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
body{ min-height:100vh; background:linear-gradient(135deg,#6C63FF,#8E7CFF); }
.auth-container{
  width:850px; min-height:480px; background:#fff; border-radius:20px;
  display:flex; box-shadow:0 20px 40px rgba(0,0,0,0.15); overflow:hidden;
  margin:60px auto 0; position:relative; z-index:1;
}
.left{ flex:1; padding:50px; display:flex; flex-direction:column; justify-content:center; }
.left h2{ margin-bottom:10px; }
.input-group{ margin-bottom:15px; }
.input-group input{
  width:100%; padding:12px; border-radius:25px;
  border:1px solid #ddd; outline:none; transition:border 0.2s;
}
.input-group input:focus{ border-color:#6C63FF; }
.login-btn{
  width:100%; padding:12px; border:none; border-radius:25px;
  background:linear-gradient(90deg,#6C63FF,#8E7CFF); color:#fff;
  font-weight:500; cursor:pointer; margin-top:10px;
}
.login-btn:hover{ opacity:0.9; }
.login-btn:disabled{ opacity:0.6; cursor:not-allowed; }
.signup-link{ margin-top:15px; font-size:14px; }
.signup-link a{ color:#6C63FF; text-decoration:none; }
.right{
  flex:1; background:linear-gradient(135deg,#6C63FF,#8E7CFF); color:#fff;
  display:flex; justify-content:center; align-items:center; text-align:center; padding:40px;
}
.right h1{ font-size:28px; }
.err-inline{ color:#ef4444; font-size:12px; margin:6px 0 0 12px; display:none; }
</style>
</head>
<body>

<nav style="width:100vw;position:fixed;top:0;left:0;background:linear-gradient(90deg,#6C63FF,#8E7CFF);padding:18px 0 18px 40px;z-index:10;box-shadow:0 2px 12px rgba(0,0,0,0.07);">
  <span style="color:#fff;font-size:1.7rem;font-weight:600;letter-spacing:1px;">RentProx</span>
</nav>

<div class="auth-container">
  <div class="left">
    <h2>Hello!</h2>
    <p>Sign in to RentProx</p>
    <div class="input-group">
      <input type="email" id="inp-email" placeholder="Email">
    </div>
    <div class="input-group">
      <input type="password" id="inp-password" placeholder="Password">
    </div>
    <div class="err-inline" id="err-msg">Email ya password galat hai.</div>
    <button class="login-btn" id="login-btn">SIGN IN</button>
    <div class="signup-link">Don't have an account? <a href="signup_plm.html">Create</a></div>
  </div>
  <div class="right">
    <div>
      <h1>Welcome Back!</h1>
      <p>Manage properties. Discover rentals. Simplify housing with RentProx.</p>
    </div>
  </div>
</div>

<script src="api.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {

  // Already logged in? Redirect
  if (Auth.getToken()) {
    window.location.href = 'User/dashboard.html';
    return;
  }

  const btn    = document.getElementById('login-btn');
  const errMsg = document.getElementById('err-msg');

  async function doLogin() {
    const email    = document.getElementById('inp-email').value.trim();
    const password = document.getElementById('inp-password').value;
    errMsg.style.display = 'none';

    if (!email || !password) {
      errMsg.textContent = 'Email aur password zaruri hain.';
      errMsg.style.display = 'block';
      return;
    }

    btn.disabled = true;
    btn.textContent = 'Signing In...';

    try {
      const data = await apiFetch('/auth/login', {
        method: 'POST',
        body: JSON.stringify({ email, password })
      });

      if (data.success) {
        Auth.save(data.data.token, data.data.user);
        // Admin -> admin dashboard, User -> user dashboard
        if (data.data.user.isAdmin) {
          window.location.href = 'Admin/admin_dashboard.html';
        } else {
          window.location.href = 'User/dashboard.html';
        }
      } else {
        errMsg.textContent = data.message || 'Login failed.';
        errMsg.style.display = 'block';
      }
    } catch {
      errMsg.textContent = 'Server se connect nahi ho saka. Backend chal raha hai?';
      errMsg.style.display = 'block';
    } finally {
      btn.disabled = false;
      btn.textContent = 'SIGN IN';
    }
  }

  btn.addEventListener('click', doLogin);
  document.addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
});
</script>
</body>
</html>